<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="favicon.png" />
  <title>GLACIER - Secure Web Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
      font-weight: 300;
      background: #ffffff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .browser-chrome {
      background: #ffffff !important;
      padding: 8px 24px !important;
      display: flex !important;
      gap: 16px !important;
      align-items: center !important;
      border-bottom: 1px solid #e8f4f8 !important;
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      z-index: 10000 !important;
      height: auto !important;
      min-height: auto !important;
      max-height: none !important;
      box-sizing: border-box !important;
    }

    .browser-chrome .logo {
      font-weight: 200 !important;
      font-size: 18px !important;
      color: #4fc3f7 !important;
      letter-spacing: 2px !important;
      margin-right: 16px !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif !important;
    }

    .url-bar {
      flex: 1 !important;
      display: flex !important;
      gap: 10px !important;
      min-width: 0 !important;
    }

    .browser-chrome #urlInput {
      flex: 1;
      padding: 8px 16px !important;
      border: 1px solid #e0e0e0 !important;
      border-radius: 6px !important;
      font-size: 13px !important;
      font-weight: 300 !important;
      outline: none !important;
      background: #fafafa !important;
      transition: all 0.3s ease !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif !important;
    }

    .browser-chrome #urlInput:focus {
      border-color: #4fc3f7 !important;
      background: #ffffff !important;
      box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.1) !important;
    }

    .browser-chrome button {
      padding: 8px 24px !important;
      background: #4fc3f7 !important;
      color: white !important;
      border: none !important;
      border-radius: 6px !important;
      cursor: pointer !important;
      font-size: 13px !important;
      font-weight: 300 !important;
      transition: all 0.3s ease !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif !important;
    }

    .browser-chrome button:hover {
      background: #29b6f6 !important;
    }

    .browser-chrome button:disabled {
      background: #e0e0e0 !important;
      cursor: not-allowed !important;
      color: #9e9e9e !important;
    }

    .nav-buttons {
      display: flex !important;
      gap: 8px !important;
      flex-shrink: 0 !important;
    }

    .browser-chrome .nav-btn {
      width: 32px !important;
      height: 32px !important;
      padding: 0 !important;
      border-radius: 6px !important;
      background: #f5f5f5 !important;
      color: #757575 !important;
      font-weight: 300 !important;
      font-size: 16px !important;
      transition: all 0.2s ease !important;
      font-family: -apple-system, BlinkMacSystemForm, 'Segoe UI', 'Helvetica Neue', sans-serif !important;
    }

    .browser-chrome .nav-btn:hover:not(:disabled) {
      background: #e3f2fd !important;
      color: #4fc3f7 !important;
    }

    .browser-chrome .nav-btn:disabled {
      background: #fafafa !important;
      color: #e0e0e0 !important;
    }

    .status {
      padding: 16px 30px !important;
      background: #fff9c4 !important;
      font-size: 14px !important;
      font-weight: 300 !important;
      display: none !important;
      animation: slideDown 0.3s ease !important;
      border-bottom: 1px solid #fff59d !important;
      position: fixed !important;
      top: 50px !important;
      left: 0 !important;
      right: 0 !important;
      z-index: 9999 !important;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status.show {
      display: block !important;
    }

    .status.error {
      background: #ffebee !important;
      color: #c62828 !important;
      border-bottom: 1px solid #ef9a9a !important;
    }

    .status.success {
      background: #e0f7fa !important;
      color: #00796b !important;
      border-bottom: 1px solid #b2ebf2 !important;
    }

    .error-toast {
      position: fixed !important;
      bottom: 20px !important;
      left: 20px !important;
      background: #c62828 !important;
      color: white !important;
      padding: 16px 24px !important;
      border-radius: 8px !important;
      font-size: 14px !important;
      font-weight: 300 !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
      display: none !important;
      animation: slideInLeft 0.3s ease !important;
      z-index: 20000 !important;
    }

    .error-toast.show {
      display: block !important;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    #content {
      flex: 1 !important;
      background: white !important;
      overflow: auto !important;
      margin-top: 50px !important;
      transform: translateZ(0) !important;
      display: flex !important;
      flex-direction: column !important;
    }
    
    .external-content-wrapper {
      width: 100%;
      height: 100%;
      overflow: auto;
      isolation: isolate;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #9e9e9e;
      font-weight: 300;
      display: none;
    }

    .spinner {
      border: 2px solid #f5f5f5;
      border-top: 2px solid #4fc3f7;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 0.8s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .welcome-screen {
      text-align: center;
      padding: 120px 20px;
      background-image: url('wallpaper.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position: relative;
      min-height: 100vh;
    }
    
    .history-btn {
      position: absolute;
      top: 30px;
      right: 30px;
      width: 40px;
      height: 40px;
      background-image: url('history.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: none;
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s ease;
      background-color: transparent;
    }
    
    .history-btn:hover {
      opacity: 1;
    }

    .welcome-screen h2 {
      font-size: 72px;
      font-weight: 100;
      color: #4fc3f7;
      margin-bottom: 60px;
      letter-spacing: 8px;
    }

    .welcome-search {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
      padding: 0 20px;
    }

    .welcome-search input {
      flex: 1;
      padding: 16px 28px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 300;
      outline: none;
      background: #fafafa;
      transition: all 0.3s ease;
    }

    .welcome-search input:focus {
      border-color: #4fc3f7;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.1);
    }

    .welcome-search button {
      padding: 16px 40px;
      background: #4fc3f7;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 300;
      transition: all 0.3s ease;
    }

    .welcome-search button:hover {
      background: #29b6f6;
    }
    
    /* èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .description-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 120px 40px;
      color: white;
      text-align: center;
    }
    
    .description-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .description-title {
      font-size: 56px;
      font-weight: 100;
      margin-bottom: 30px;
      letter-spacing: 4px;
      text-transform: uppercase;
    }
    
    .description-subtitle {
      font-size: 22px;
      font-weight: 300;
      line-height: 1.8;
      margin-bottom: 80px;
      opacity: 0.95;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 50px;
      margin-top: 80px;
    }
    
    .feature-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 50px 40px;
      border-radius: 20px;
      transition: transform 0.3s ease, background 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .feature-card:hover {
      transform: translateY(-15px);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .feature-icon {
      font-size: 64px;
      margin-bottom: 25px;
    }
    
    .feature-title {
      font-size: 26px;
      font-weight: 300;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }
    
    .feature-description {
      font-size: 16px;
      font-weight: 300;
      line-height: 1.8;
      opacity: 0.9;
    }
    
    /* å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .history-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      animation: fadeIn 0.3s ease;
    }
    
    .history-modal.show {
      display: flex;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .history-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 70vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 15px;
    }
    
    .history-header h3 {
      font-size: 24px;
      font-weight: 300;
      color: #4fc3f7;
      margin: 0;
    }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 28px;
      color: #9e9e9e;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      line-height: 1;
      transition: color 0.3s ease;
    }
    
    .close-btn:hover {
      color: #4fc3f7;
    }
    
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .history-item {
      padding: 12px 16px;
      border-bottom: 1px solid #f5f5f5;
      cursor: pointer;
      transition: background 0.2s ease;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    
    .history-item:hover {
      background: #e3f2fd;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-item-url {
      font-size: 14px;
      color: #333;
      font-weight: 400;
      word-break: break-all;
    }
    
    .history-item-time {
      font-size: 12px;
      color: #9e9e9e;
      margin-top: 4px;
    }
    
    .history-empty {
      text-align: center;
      padding: 40px 20px;
      color: #9e9e9e;
      font-weight: 300;
    }
    
    .clear-history-btn {
      width: 100%;
      padding: 12px;
      background: #ffebee;
      color: #c62828;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 300;
      margin-top: 15px;
      transition: background 0.3s ease;
    }
    
    .clear-history-btn:hover {
      background: #ffcdd2;
    }
  </style>
</head>
<body>
  <div class="browser-chrome">
    <div class="logo">GLACIER</div>
    <div class="nav-buttons">
      <button class="nav-btn" id="homeBtn" title="ãƒ›ãƒ¼ãƒ ">âŒ‚</button>
      <button class="nav-btn" id="backBtn" disabled title="æˆ»ã‚‹">â†</button>
      <button class="nav-btn" id="forwardBtn" disabled title="é€²ã‚€">â†’</button>
      <button class="nav-btn" id="reloadBtn" disabled title="å†èª­ã¿è¾¼ã¿">â†»</button>
    </div>
    <div class="url-bar">
      <input type="text" id="urlInput" placeholder="Enter URL">
      <button id="goBtn">Go</button>
    </div>
  </div>

  <div class="status" id="status"></div>
  <div class="error-toast" id="errorToast">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</div>

  <div id="content">
    <div class="welcome-screen">
      <button class="history-btn" id="historyBtn" title="å±¥æ­´"></button>
      <h2>GLACIER</h2>
      <div class="welcome-search">
        <input type="text" id="welcomeUrlInput" placeholder="Enter URL">
        <button id="welcomeGoBtn">Go</button>
      </div>
    </div>
    
    <!-- èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="description-section">
      <div class="description-container">
        <h3 class="description-title">Next Generation Browsing</h3>
        <p class="description-subtitle">
          GLACIERã¯ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’æœ€å„ªå…ˆã«è¨­è¨ˆã•ã‚ŒãŸ<br>
          æ¬¡ä¸–ä»£å‹Webãƒ–ãƒ©ã‚¦ã‚¶ã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã§æ´—ç·´ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒã€<br>
          ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä½“é¨“ã‚’é©æ–°ã—ã¾ã™ã€‚
        </p>
        
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ”’</div>
            <h4 class="feature-title">Secure</h4>
            <p class="feature-description">
              é«˜åº¦ãªæš—å·åŒ–æŠ€è¡“ã«ã‚ˆã‚Šã€ã‚ãªãŸã®é€šä¿¡ã‚’å®Œå…¨ã«ä¿è­·ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å®ˆã‚ŠãªãŒã‚‰å®‰å…¨ãªãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">âš¡</div>
            <h4 class="feature-title">Fast</h4>
            <p class="feature-description">
              æœ€é©åŒ–ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚Šã€è¶…é«˜é€Ÿãªãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚’å®Ÿç¾ã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã®ãªã„ã‚¹ãƒ ãƒ¼ã‚ºãªæ“ä½œæ„Ÿã‚’æä¾›ã—ã¾ã™ã€‚
            </p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">ğŸ¨</div>
            <h4 class="feature-title">Minimal</h4>
            <p class="feature-description">
              ç„¡é§„ã‚’çœã„ãŸãƒŸãƒ‹ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚æœ¬å½“ã«å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’å³é¸ã—ã€ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„UIã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="history-modal" id="historyModal">
    <div class="history-content">
      <div class="history-header">
        <h3>é–²è¦§å±¥æ­´</h3>
        <button class="close-btn" id="closeHistoryBtn">Ã—</button>
      </div>
      <ul class="history-list" id="historyList"></ul>
      <button class="clear-history-btn" id="clearHistoryBtn">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const goBtn = document.getElementById('goBtn');
    const homeBtn = document.getElementById('homeBtn');
    const backBtn = document.getElementById('backBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const reloadBtn = document.getElementById('reloadBtn');
    const contentDiv = document.getElementById('content');
    const statusDiv = document.getElementById('status');
    const errorToast = document.getElementById('errorToast');
    const welcomeUrlInput = document.getElementById('welcomeUrlInput');
    const welcomeGoBtn = document.getElementById('welcomeGoBtn');
    const historyBtn = document.getElementById('historyBtn');
    const historyModal = document.getElementById('historyModal');
    const closeHistoryBtn = document.getElementById('closeHistoryBtn');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');

    let history = [];
    let historyIndex = -1;
    let currentUrl = '';
    let browsingHistory = [];

    function shortenUrl(url) {
      try {
        return btoa(unescape(encodeURIComponent(url)));
      } catch (e) {
        console.error('Encoding error:', e);
        return btoa(url);
      }
    }

    function showStatus(message, type = 'info') {
      statusDiv.textContent = message;
      statusDiv.className = `status show ${type}`;
      setTimeout(() => {
        statusDiv.className = 'status';
      }, 3000);
    }

    function showError(message = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚') {
      errorToast.textContent = message;
      errorToast.classList.add('show');
      setTimeout(() => {
        errorToast.classList.remove('show');
      }, 4000);
    }

    function updateNavButtons() {
      backBtn.disabled = historyIndex <= 0;
      forwardBtn.disabled = historyIndex >= history.length - 1;
      reloadBtn.disabled = !currentUrl;
    }

    function isUrl(text) {
      const urlPattern = /^([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(:[0-9]+)?(\/.*)?$|^localhost(:[0-9]+)?(\/.*)?$/;
      const ipPattern = /^(\d{1,3}\.){3}\d{1,3}(:[0-9]+)?(\/.*)?$/;
      
      return text.startsWith('http://') || 
             text.startsWith('https://') || 
             urlPattern.test(text) ||
             ipPattern.test(text);
    }

    async function loadUrl(url, addToHistory = true) {
      if (!url) return;

      if (!isUrl(url)) {
        url = `https://search.brave.com/search?q=${encodeURIComponent(url)}`;
      } else {
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          url = 'https://' + url;
        }
      }

      try {
        goBtn.disabled = true;
        
        const shortUrl = shortenUrl(url);
        
        console.log('Sending encoded URL:', shortUrl);

        const fetchRes = await fetch(`/fetch?h=${encodeURIComponent(shortUrl)}`);
        
        console.log('Response status:', fetchRes.status);
        
        const data = await fetchRes.json();
        console.log('Response data:', data);

        if (!fetchRes.ok) {
          throw new Error(data.error || 'Failed to fetch');
        }

        currentUrl = data.url;
        urlInput.value = currentUrl;
        displayHtml(data.html, currentUrl);

        if (addToHistory) {
          historyIndex++;
          history = history.slice(0, historyIndex);
          history.push(currentUrl);
          
          const existingIndex = browsingHistory.findIndex(item => item.url === currentUrl);
          if (existingIndex !== -1) {
            browsingHistory.splice(existingIndex, 1);
          }
          browsingHistory.unshift({
            url: currentUrl,
            timestamp: new Date().toLocaleString('ja-JP')
          });
          
          if (browsingHistory.length > 100) {
            browsingHistory = browsingHistory.slice(0, 100);
          }
          
          try {
            localStorage.setItem('browsingHistory', JSON.stringify(browsingHistory));
          } catch (e) {
            console.error('Failed to save history:', e);
          }
        }

        updateNavButtons();

      } catch (error) {
        console.error('Error:', error);
        showError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      } finally {
        goBtn.disabled = false;
      }
    }

    function displayHtml(html, baseUrl) {
      const wrapper = document.createElement('div');
      wrapper.className = 'external-content-wrapper';
      wrapper.innerHTML = html;
      
      contentDiv.innerHTML = '';
      contentDiv.appendChild(wrapper);

      function resolveUrl(relativeUrl, baseUrl) {
        if (!relativeUrl || relativeUrl.startsWith('http') || relativeUrl.startsWith('data:') || relativeUrl.startsWith('mailto:')) {
            return relativeUrl;
        }

        try {
            const base = new URL(baseUrl);
            
            if (relativeUrl.startsWith('//')) {
                return base.protocol + relativeUrl;
            } else if (relativeUrl.startsWith('/')) {
                return base.origin + relativeUrl;
            } else {
                const pathSegments = base.pathname.split('/').slice(0, -1);
                return base.origin + pathSegments.join('/') + '/' + relativeUrl;
            }
        } catch (e) {
            console.error("URL resolution error:", e);
            return relativeUrl;
        }
      }

      const cssLinks = wrapper.querySelectorAll('link[rel="stylesheet"], link[rel="preload"][as="style"]');
      cssLinks.forEach(link => {
        const href = link.getAttribute('href');
        link.href = resolveUrl(href, baseUrl);
      });

      const anchorTags = wrapper.querySelectorAll('a[href]');
      anchorTags.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          let href = link.getAttribute('href');

          if (href.startsWith('#')) {
             return;
          }

          loadUrl(resolveUrl(href, baseUrl));
        });
      });

      const images = wrapper.querySelectorAll('img[src]');
      images.forEach(img => {
        let src = img.getAttribute('src');
        img.src = resolveUrl(src, baseUrl);
      });
    }

    function showHistory() {
      historyList.innerHTML = '';
      
      if (browsingHistory.length === 0) {
        historyList.innerHTML = '<div class="history-empty">é–²è¦§å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      browsingHistory.forEach(item => {
        const li = document.createElement('li');
        li.className = 'history-item';
        li.innerHTML = `
          <div class="history-item-url">${item.url}</div>
          <div class="history-item-time">${item.timestamp}</div>
        `;
        li.addEventListener('click', () => {
          historyModal.classList.remove('show');
          loadUrl(item.url);
        });
        historyList.appendChild(li);
      });
    }
    
    function clearHistory() {
      if (confirm('ã™ã¹ã¦ã®é–²è¦§å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
        browsingHistory = [];
        try {
          localStorage.removeItem('browsingHistory');
        } catch (e) {
          console.error('Failed to clear history:', e);
        }
        showHistory();
      }
    }
    
    try {
      const savedHistory = localStorage.getItem('browsingHistory');
      if (savedHistory) {
        browsingHistory = JSON.parse(savedHistory);
      }
    } catch (e) {
      console.error('Failed to load history:', e);
    }

    goBtn.addEventListener('click', () => loadUrl(urlInput.value));
    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') loadUrl(urlInput.value);
    });

    welcomeGoBtn.addEventListener('click', () => loadUrl(welcomeUrlInput.value));
    welcomeUrlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') loadUrl(welcomeUrlInput.value);
    });

    homeBtn.addEventListener('click', () => {
      currentUrl = '';
      urlInput.value = '';
      historyIndex = -1;
      history = [];
      contentDiv.innerHTML = `
        <div class="welcome-screen">
          <button class="history-btn" id="historyBtn" title="å±¥æ­´"></button>
          <h2>GLACIER</h2>
          <div class="welcome-search">
            <input type="text" id="welcomeUrlInput" placeholder="Enter URL">
            <button id="welcomeGoBtn">Go</button>
          </div>
        </div>
        <div class="description-section">
          <div class="description-container">
            <h3 class="description-title">Next Generation Browsing</h3>
            <p class="description-subtitle">
              GLACIERã¯ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’æœ€å„ªå…ˆã«è¨­è¨ˆã•ã‚ŒãŸ<br>
              æ¬¡ä¸–ä»£å‹Webãƒ–ãƒ©ã‚¦ã‚¶ã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã§æ´—ç·´ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒã€<br>
              ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä½“é¨“ã‚’é©æ–°ã—ã¾ã™ã€‚
            </p>
            
            <div class="features-grid">
              <div class="feature-card">
                <div class="feature-icon">ğŸ”’</div>
                <h4 class="feature-title">Secure</h4>
                <p class="feature-description">
                  é«˜åº¦ãªæš—å·åŒ–æŠ€è¡“ã«ã‚ˆã‚Šã€ã‚ãªãŸã®é€šä¿¡ã‚’å®Œå…¨ã«ä¿è­·ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å®ˆã‚ŠãªãŒã‚‰å®‰å…¨ãªãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
                </p>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">âš¡</div>
                <h4 class="feature-title">Fast</h4>
                <p class="feature-description">
                  æœ€é©åŒ–ã•ã‚ŒãŸã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚Šã€è¶…é«˜é€Ÿãªãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚’å®Ÿç¾ã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã®ãªã„ã‚¹ãƒ ãƒ¼ã‚ºãªæ“ä½œæ„Ÿã‚’æä¾›ã—ã¾ã™ã€‚
                </p>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">ğŸ¨</div>
                <h4 class="feature-title">Minimal</h4>
                <p class="feature-description">
                  ç„¡é§„ã‚’çœã„ãŸãƒŸãƒ‹ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚æœ¬å½“ã«å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’å³é¸ã—ã€ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„UIã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      `;
      const newWelcomeUrlInput = document.getElementById('welcomeUrlInput');
      const newWelcomeGoBtn = document.getElementById('welcomeGoBtn');
      const newHistoryBtn = document.getElementById('historyBtn');
      newWelcomeGoBtn.addEventListener('click', () => loadUrl(newWelcomeUrlInput.value));
      newWelcomeUrlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') loadUrl(newWelcomeUrlInput.value);
      });
      newHistoryBtn.addEventListener('click', () => {
        showHistory();
        historyModal.classList.add('show');
      });
      updateNavButtons();
    });

    backBtn.addEventListener('click', () => {
      if (historyIndex > 0) {
        historyIndex--;
        loadUrl(history[historyIndex], false);
      }
    });

    forwardBtn.addEventListener('click', () => {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        loadUrl(history[historyIndex], false);
      }
    });

    reloadBtn.addEventListener('click', () => {
      if (currentUrl) loadUrl(currentUrl, false);
    });
    
    historyBtn.addEventListener('click', () => {
      showHistory();
      historyModal.classList.add('show');
    });
    
    closeHistoryBtn.addEventListener('click', () => {
      historyModal.classList.remove('show');
    });
    
    clearHistoryBtn.addEventListener('click', clearHistory);
    
    historyModal.addEventListener('click', (e) => {
      if (e.target === historyModal) {
        historyModal.classList.remove('show');
      }
    });
  </script>
</body>
</html>
